window.Voucherify=function(e,t,n){"use strict";function o(e){return Math.round(100.001*e)/100}function i(e){if(!e||0>e||e>100)throw new Error("Invalid voucher, percent discount should be between 0-100.")}function r(e){if(!e||0>e)throw new Error("Invalid voucher, amount discount must be higher than zero.")}function a(e){if(!e||0>e)throw new Error("Invalid voucher, unit discount must be higher than zero.")}var c="https://api.voucherify.io",u={validate:c+"/client/v1/validate",redeem:c+"/client/v1/redeem"},s={},l=null;l=n&&"function"==typeof n.ajax&&n.Deferred?function(e,t,o,i){var r=null;return"function"!=typeof i&&(r=n.Deferred()),n.ajax({type:e,url:t,data:JSON.stringify(o),xhrFields:{withCredentials:!0},dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json","X-Client-Application-Id":s.applicationId,"X-Client-Token":s.token,"X-Voucherify-Channel":"Voucherify.js"},timeout:s.timeout,success:function(e){var t=null;!e||"boolean"!=typeof e.valid&&"string"!=typeof e.result?(t={type:"error",message:"Unexpected response structure.",context:e},"function"==typeof i?i(t):r.reject(t)):"function"==typeof i?i(e):r.resolve(e)},error:function(e){var t={type:"error",message:"XHR error happened.",context:e};"function"==typeof i?i(t):r.reject(t)}}),"function"!=typeof i?r.promise():void 0}:function(t,n,o,i){var r=new e.XMLHttpRequest;r.withCredentials=!0,r.open(t,n,!0),r.timeout=s.timeout,r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("X-Client-Application-Id",s.applicationId),r.setRequestHeader("X-Client-Token",s.token),r.setRequestHeader("X-Voucherify-Channel","Voucherify.js"),r.onload=function(){var e=null;if(r.status>=200&&r.status<400){var t=JSON.parse(r.responseText);!t||"boolean"!=typeof t.valid&&"string"!=typeof t.result?(e={type:"error",message:"Unexpected response structure.",context:t},"function"==typeof i&&i(e)):"function"==typeof i&&i(t)}else e={type:"error",message:"Unexpected status code.",context:r.status},"function"==typeof i&&i(e)},r.onerror=function(e){var t={type:"error",message:"XHR error happened.",context:e};"function"==typeof i&&i(t)},r.send(JSON.stringify(o))};var d={initialize:function(e,t,n){s.applicationId=e,s.token=t,s.timeout=n||5e3},setIdentity:function(e){s.trackingId=e},validate:function(e,t){if(!s.applicationId&&!s.token)return console.error("Voucherify client could not verify coupon - Lack of configuration - Missing Client Application ID or Token."),null;var n,o;if("object"==typeof e&&(n=e.amount,o=e.items,e=e.code),e&&(e=e.replace(/[\s\r\n]/g,"")),!e)return console.error("Voucherify client could not verify code, because it is missing - please provide Voucher Code."),null;var i="?code="+encodeURIComponent(e);return n&&(i+="&amount="+parseInt(n)),o&&(i+="&"+o.map(function(e,t){return Object.keys(e).map(function(n){return encodeURIComponent("item["+t+"]["+n+"]")+"="+encodeURIComponent(e[n])}).join("&")}).join("&")),s.trackingId&&(i+="&tracking_id="+encodeURIComponent(s.trackingId)),l("GET",u.validate+i,void 0,t)},redeem:function(e,t,n){if(!s.applicationId&&!s.token)return console.error("Voucherify client could not redeem coupon - Lack of configuration - Missing Client Application ID or Token."),null;if(!e)return console.error("Voucherify client could not verify code, because it is missing - please provide Voucher Code."),null;var o="?code="+encodeURIComponent(e.replace(/[\s\r\n]/g,""));return t=t||{},t.customer=t.customer||{},t.customer.source_id=t.customer.source_id||s.trackingId,l("POST",u.redeem+o,t,n)},utils:{calculatePrice:function(e,t,n){var c,u=100;if(t.gift)return c=Math.min(t.gift.balance/u,e),o(e-c);if(!t.discount)throw new Error("Unsupported voucher type.");if("PERCENT"===t.discount.type){c=t.discount.percent_off,i(c);var s=e*(c/100);return o(e-s)}if("AMOUNT"===t.discount.type){c=t.discount.amount_off/u,r(c);var l=e-c;return o(l>0?l:0)}if("UNIT"===t.discount.type){c=t.discount.unit_off,a(c);var l=e-n*c;return o(l>0?l:0)}throw new Error("Unsupported discount type.")},calculateDiscount:function(e,t,n){var c,u=100;if(t.gift)return c=Math.min(t.gift.balance/u,e),o(c);if(!t.discount)throw new Error("Unsupported voucher type.");if("PERCENT"===t.discount.type)return c=t.discount.percent_off,i(c),o(e*(c/100));if("AMOUNT"===t.discount.type){c=t.discount.amount_off/u,r(c);var s=e-c;return o(s>0?c:e)}if("UNIT"===t.discount.type){c=t.discount.unit_off,a(c);var l=n*c;return o(l>e?e:l)}throw new Error("Unsupported discount type.")}},render:function(e,o){function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}function r(e,t){return e+i(t)}function a(e,t){return o[r(e,t)]}function c(e,o,i,c){c=c||{};var u=null,s=a("selector",o);if(c.configurable&&s&&(u=n(s)),!u||!u.length){u=n(t.createElement(e)),i.append(u);for(var l in c)"configurable"!==l&&c.hasOwnProperty(l)&&u.attr(l,c[l]);"input"===e&&u.attr("name",r("voucherify",o)),"span"===e&&c.text&&u.text(c.text)}return u.addClass("string"==typeof a("class",o)?a("class",o):r("voucherify",o)),u}var u=n(e);if(!u||!u.length)throw new Error("Element '"+e+"' cannot be found");o=o||{};var s=c("div","container",u),l=c("figure","logo",s),d=(c("img","logo",l,{src:"string"==typeof o.logoSrc?o.logoSrc:"https://app.voucherify.io/images/favicon.png"}),c("input","code",s,{type:"text",placeholder:"string"==typeof o.textPlaceholder?o.textPlaceholder:"e.g. abc-123"})),f=c("input","discountType",s,{type:"hidden",configurable:!0}),p=c("input","percentOff",s,{type:"hidden",configurable:!0}),g=c("input","amountOff",s,{type:"hidden",configurable:!0}),v=c("input","unitOff",s,{type:"hidden",configurable:!0}),y=c("input","tracking",s,{type:"hidden",configurable:!0}),h=c("button","validate",s,{}),m=(c("span","validateText",h,{text:"string"==typeof o.textValidate?o.textValidate:"Validate"}),this),C="string"===o.classInvalid?o.classInvalid:"voucherifyInvalid",I="string"==typeof o.classValid?o.classValid:"voucherifyValid",w="string"===o.classInvalidAnimation?o.classInvalidAnimation:"voucherifyAnimationShake",b="string"===o.classValidAnimation?o.classValidAnimation:"voucherifyAnimationTada";d.on("keyup",function(e){d.toggleClass(w,!1)}),h.on("click",function(e){return f.val(""),g.val(""),v.val(""),p.val(""),y.val(""),h.toggleClass(C,!1),h.toggleClass(I,!1),d.val()?void m.validate(d.val(),function(e){return e&&e.valid?(d.toggleClass(C,!1),f.val(e.discount&&e.discount.type||""),g.val(e.discount&&e.discount.amount_off||0),v.val(e.discount&&e.discount.unit_off||0),p.val(e.discount&&e.discount.percent_off||0),y.val(e.tracking_id||""),d.prop("disabled",!0),h.prop("disabled",!0),d.toggleClass(I,!0),h.toggleClass(I,!0),h.toggleClass(C,!1),d.toggleClass(C,!1),d.toggleClass(b,!0),void(o&&o.onValidated&&"function"==typeof o.onValidated&&o.onValidated(e))):(h.toggleClass(C,!0),h.toggleClass(I,!1),d.toggleClass(C,!0),d.toggleClass(I,!1),void d.toggleClass(w,!0).delay(1e3).queue(function(){d.toggleClass(w,!1),d.dequeue()}))}):void d.toggleClass(w,!0).delay(1e3).queue(function(){d.toggleClass(w,!1),d.dequeue()})})}};return"undefined"!=typeof module&&module.exports&&(module.exports=d),d}(window,window.document,window.jQuery);
//# sourceMappingURL=voucherify.min.js.map
