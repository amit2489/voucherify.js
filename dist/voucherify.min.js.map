{"version":3,"sources":["voucherify.js"],"names":["window","Voucherify","document","$","roundMoney","value","Math","round","validatePercentDiscount","discount","Error","validateAmountDiscount","validateUnitDiscount","OPTIONS","url","xhrImplementation","Deferred","queryString","callback","deferred","ajax","type","xhrFields","withCredentials","dataType","headers","X-Client-Application-Id","applicationId","X-Client-Token","token","X-Voucherify-Channel","timeout","success","data","result","resolve","message","context","reject","error","promise","undefined","request","XMLHttpRequest","open","setRequestHeader","onload","status","JSON","parse","responseText","onerror","send","voucherify","initialize","clientAppId","setIdentity","trackingId","validate","code","console","amount","replace","encodeURIComponent","parseInt","utils","calculatePrice","basePrice","voucher","unitPrice","e","percent_off","priceDiscount","amount_off","newPrice","unit_off","calculateDiscount","render","selector","options","getCapitalizedName","name","charAt","toUpperCase","slice","getPropertyName","prefix","getConfigProperty","create$control","$container","config","$control","configured$control","configurable","length","createElement","append","attribute","hasOwnProperty","attr","text","html","addClass","$element","captionBody","$code","placeholder","textPlaceholder","$discountType","$percentOff","$amountOff","$unitOff","$tracking","$validate","self","textValidate","this","classInvalid","classValid","classInvalidAnimation","classValidAnimation","on","event","toggleClass","val","response","valid","tracking_id","prop","onValidated","delay","queue","dequeue","jQuery"],"mappings":"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","file":"voucherify.min.js","sourcesContent":["window.Voucherify = (function (window, document, $) {\n  \"use strict\";\n\n  var OPTIONS = {\n    url: \"https://api.voucherify.io/client/v1/validate\"\n  };\n\n  var xhrImplementation = null;\n\n  if (!!$ && typeof($.ajax) === \"function\" && !!$.Deferred) {\n    xhrImplementation = function (queryString, callback) {\n      var deferred = null;\n\n      if (typeof(callback) !== \"function\") {\n        deferred = $.Deferred();\n      }\n\n      $.ajax({\n        type: \"GET\",\n\n        url: OPTIONS.url + queryString,\n\n        xhrFields: {\n          withCredentials: true\n        },\n\n        dataType: \"json\",\n        headers: {\n          \"X-Client-Application-Id\": OPTIONS.applicationId,\n          \"X-Client-Token\": OPTIONS.token,\n          \"X-Voucherify-Channel\": \"Voucherify.js\"\n        },\n        timeout: OPTIONS.timeout,\n\n        success: function (data) {\n          var result = null;\n\n          if (data && typeof(data.valid) === \"boolean\") {\n            if (typeof(callback) === \"function\") {\n              callback(data);\n            } else {\n              deferred.resolve(data);\n            }\n          } else {\n            result = {\n              type: \"error\",\n              message: \"Unexpected response structure.\",\n              context: data\n            };\n\n            if (typeof(callback) === \"function\") {\n              callback(result);\n            } else {\n              deferred.reject(result);\n            }\n          }\n        },\n\n        error: function (error) {\n          var result = {\n            type: \"error\",\n            message: \"XHR error happened.\",\n            context: error\n          };\n\n          if (typeof(callback) === \"function\") {\n            callback(result);\n          } else {\n            deferred.reject(result);\n          }\n        }\n      });\n\n      if (typeof(callback) !== \"function\") {\n        return deferred.promise();\n      } else {\n        return undefined;\n      }\n    };\n  } else {\n    xhrImplementation = function (queryString, callback) {\n      var request = new window.XMLHttpRequest();\n\n      request.timeout = OPTIONS.timeout;\n      request.withCredentials = true;\n      request.open(\"GET\", OPTIONS.url + queryString, true);\n\n      request.setRequestHeader(\"X-Client-Application-Id\", OPTIONS.applicationId);\n      request.setRequestHeader(\"X-Client-Token\", OPTIONS.token);\n      request.setRequestHeader(\"X-Voucherify-Channel\", \"Voucherify.js\");\n\n      request.onload = function() {\n        var result = null;\n\n        if (request.status >= 200 && request.status < 400) {\n          var data = JSON.parse(request.responseText);\n\n          if (data && typeof(data.valid) === \"boolean\") {\n            if (typeof(callback) === \"function\") {\n              callback(data);\n            }\n          } else {\n            result = {\n              type: \"error\",\n              message: \"Unexpected response structure.\",\n              context: data\n            };\n\n            if (typeof(callback) === \"function\") {\n              callback(result);\n            }\n          }\n        } else {\n          result = {\n            type: \"error\",\n            message: \"Unexpected status code.\",\n            context: request.status\n          };\n\n          if (typeof(callback) === \"function\") {\n            callback(result);\n          }\n        }\n      };\n\n      request.onerror = function (error) {\n        var result = {\n          type: \"error\",\n          message: \"XHR error happened.\",\n          context: error\n        };\n\n        if (typeof(callback) === \"function\") {\n          callback(result);\n        }\n      };\n\n      request.send();\n    };\n  }\n\n  function roundMoney(value) {\n    return Math.round(value * (100 + 0.001)) / 100;\n  }\n\n  function validatePercentDiscount(discount) {\n    if (!discount || discount < 0 || discount > 100) {\n      throw new Error('Invalid voucher, percent discount should be between 0-100.');\n    }\n  }\n\n  function validateAmountDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, amount discount must be higher than zero.\");\n    }\n  }\n\n  function validateUnitDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, unit discount must be higher than zero.\");\n    }\n  }\n\n  var voucherify = {\n    initialize: function (clientAppId, token, timeout) {\n      OPTIONS.applicationId = clientAppId;\n      OPTIONS.token = token;\n      OPTIONS.timeout = timeout || 5000;\n    },\n\n    setIdentity: function (trackingId) {\n      OPTIONS.trackingId = trackingId;\n    },\n\n    validate: function (code, callback) {\n      if (!OPTIONS.applicationId && !OPTIONS.token) {\n        console.error(\"Voucherify client could not verify coupon - Lack of configuration - Missing Client Application ID or Token.\");\n        return null;\n      }\n\n      var amount;\n\n      if (typeof(code) === \"object\") {\n        amount = code.amount;\n        code = code.code;\n      }\n\n      if (!!code) {\n        code = code.replace(/[\\s\\r\\n]/g, \"\");\n      }\n\n      if (!code) {\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\n        return null;\n      }\n\n      var queryString = \"?code=\" + encodeURIComponent(code);\n\n      if (amount) {\n        queryString += \"&amount=\" + parseInt(amount); // in cents, amount=1000 means $10\n      }\n\n      if (OPTIONS.trackingId) {\n        queryString += \"&tracking_id=\" + encodeURIComponent(OPTIONS.trackingId);\n      }\n\n      return xhrImplementation(queryString, callback);\n    },\n\n    utils: {\n      calculatePrice: function (basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          var priceDiscount = basePrice * (discount / 100);\n          return roundMoney(basePrice - priceDiscount);\n\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var newPrice = basePrice - unitPrice * discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      },\n\n      calculateDiscount: function(basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          return roundMoney(basePrice * (discount / 100));\n\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? discount : basePrice);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var priceDiscount = unitPrice * discount;\n          return roundMoney(priceDiscount > basePrice ? basePrice : priceDiscount);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      }\n    },\n    render: function(selector, options) {\n      var $element = $(selector);\n      if (!$element || !$element.length) {\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\n      }\n      options = options || {};\n\n      function getCapitalizedName(name) {\n        return name.charAt(0).toUpperCase() + name.slice(1);\n      }\n      \n      function getPropertyName(prefix, name) {\n        return prefix + getCapitalizedName(name);\n      }\n      \n      function getConfigProperty(prefix, name) {\n        return options[getPropertyName(prefix, name)];\n      }\n\n      function create$control(type, name, $container, config) {\n        config = config || {};\n        var $control = null;\n        var configured$control = getConfigProperty(\"selector\", name);\n        \n        if (config.configurable && configured$control) {\n          $control = $(configured$control);\n        }\n        \n        if (!$control || !$control.length) {\n          $control = $(document.createElement(type));\n          $container.append($control);\n          \n          for (var attribute in config) {\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\n              $control.attr(attribute, config[attribute]);\n            }\n          }\n          \n          if (type === \"input\") {\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\n          }\n          \n          if (type === \"span\" && config.text) {\n            $control.text(config.text);\n          }\n\n          if (type === \"div\" && config.html) {\n            $control.html(config.html);\n          }\n        }\n        \n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\n        return $control;\n      }\n\n      var captionBody = \"Powered by <a href=\\\"http://voucherify.io\\\" target=\\\"_blank\\\" title=\\\"Voucherify - voucher infrastructure through API\\\">Voucherify</a>\";\n\n      var $container     = create$control(\"div\", \"container\", $element);\n      var $code          = create$control(\"input\", \"code\", $container, { type: \"text\", placeholder: typeof options.textPlaceholder === \"string\" ? options.textPlaceholder : \"e.g. abc-123\" });\n      var $discountType  = create$control(\"input\", \"discountType\", $container, { type: \"hidden\", configurable: true });\n      var $percentOff    = create$control(\"input\", \"percentOff\", $container, { type: \"hidden\", configurable: true });\n      var $amountOff     = create$control(\"input\", \"amountOff\", $container, { type: \"hidden\", configurable: true });\n      var $unitOff       = create$control(\"input\", \"unitOff\", $container, { type: \"hidden\", configurable: true });\n      var $tracking      = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\n      var $validate      = create$control(\"button\", \"validate\", $container, {});\n      var $caption       = create$control(\"div\", \"caption\", $container, { html: captionBody });\n      var $validateText  = create$control(\"span\", \"validateText\", $validate, { text: typeof options.textValidate === \"string\" ? options.textValidate : \"Validate\" });\n\n      var self = this;\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\n\n      $code.on(\"keyup\", function(event) {\n        $code.toggleClass(classInvalidAnimation, false);\n      });\n\n      $validate.on(\"click\", function(event) {\n        $discountType.val(\"\");\n        $amountOff.val(\"\");\n        $unitOff.val(\"\");\n        $percentOff.val(\"\");\n        $tracking.val(\"\");\n\n        $validate.toggleClass(classInvalid, false);\n        $validate.toggleClass(classValid, false);\n        \n        if (!$code.val()) {\n          $code.toggleClass(classInvalidAnimation, true)\n            .delay(1000)\n            .queue(function(){\n                $code.toggleClass(classInvalidAnimation, false);\n                $code.dequeue();\n            });\n          return;\n        }\n\n        self.validate($code.val(), function(response) {   \n          if (!response || !response.valid) {\n            $validate.toggleClass(classInvalid, true);\n            $validate.toggleClass(classValid, false);\n            $code.toggleClass(classInvalid, true);\n            $code.toggleClass(classValid, false);\n            $code.toggleClass(classInvalidAnimation, true)\n              .delay(1000)\n              .queue(function(){\n                $code.toggleClass(classInvalidAnimation, false);\n                $code.dequeue();\n              });\n            return;\n          }\n\n        $code.toggleClass(classInvalid, false);\n          $discountType.val(response.discount && response.discount.type || \"\");\n          $amountOff.val(response.discount && response.discount.amount_off || 0);\n          $unitOff.val(response.discount && response.discount.unit_off || 0);\n          $percentOff.val(response.discount && response.discount.percent_off || 0);\n          $tracking.val(response.tracking_id || \"\");\n        \n          $code.prop(\"disabled\", true);\n          $validate.prop(\"disabled\", true);\n\n          $code.toggleClass(classValid, true);\n          $validate.toggleClass(classValid, true);\n          $validate.toggleClass(classInvalid, false);\n          $code.toggleClass(classInvalid, false);\n            \n          $code.toggleClass(classValidAnimation, true)\n\n          if (options && options.onValidated && typeof options.onValidated === \"function\") {\n            options.onValidated(response);\n          }\n        });\n      });\n    }\n  };\n\n  return voucherify;\n} (window, window.document, window.jQuery));"],"sourceRoot":"/source/"}