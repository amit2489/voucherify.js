{"version":3,"sources":["voucherify.js"],"names":["window","Voucherify","document","$","isValidResponseStructure","data","roundMoney","value","Math","round","validatePercentDiscount","discount","Error","validateAmountDiscount","validateUnitDiscount","isValidInit","options","applicationId","console","error","renderIframes","RenderIframe","element","self","this","_host","_path","_allowed_options","_element","_options","helpers","readOptions","_iframe","renderIframe","bind","name","callback","addEventListener","attachEvent","allowed_options","Array","prototype","reduce","call","allowed_option","option_value","getAttribute","encodeOptions","query_parameters","Object","keys","forEach","option_key","push","encodeURIComponent","join","css_props","createElement","setAttribute","style","cssText","visibility","src","append","elements","querySelectorAll","API_BASE","API","validate","redeem","publish","list","OPTIONS","INVALID_AMOUNT","INVALID_NUMBER","MISSING_AMOUNT","INVALID_CUSTOMER_PHONE","EMAIL_PATTERN","xhrImplementation","Deferred","method","url","payload","deferred","ajax","type","JSON","stringify","xhrFields","withCredentials","dataType","headers","Accept","Content-Type","X-Client-Application-Id","X-Client-Token","token","X-Voucherify-Channel","timeout","success","result","resolve","message","context","reject","promise","undefined","request","XMLHttpRequest","open","setRequestHeader","onload","status","parse","responseText","onerror","send","voucherify","initialize","clientAppId","setIdentity","trackingId","code","amount","items","metadata","customer","replace","queryString","parseInt","map","item","index","key","source_id","campaign","channel","listVouchers","filters","utils","calculatePrice","basePrice","voucher","unitPrice","e","gift","min","balance","percent_off","priceDiscount","amount_off","newPrice","unit_off","calculateDiscount","render","selector","getCapitalizedName","charAt","toUpperCase","slice","getPropertyName","prefix","getConfigProperty","create$control","$container","config","$control","configured$control","configurable","length","attribute","hasOwnProperty","attr","text","addClass","$element","$logoContainer","$code","logoSrc","placeholder","textPlaceholder","$amount","amountPlaceholder","$discountType","$percentOff","$amountOff","$unitOff","$tracking","$validate","textValidate","classInvalid","classValid","classInvalidAnimation","classValidAnimation","on","event","toggleClass","val","delay","queue","dequeue","parseFloat","response","valid","setFieldInvalid","$field","responseJSON","error_key","hide","tracking_id","prop","onValidated","renderPublish","contains","arr","some","field","containsCustomer","customerFields","isRequired","find","required","error$control","campaignName","$customerName","customerNamePlaceholder","$row1","$customerEmail","customerEmailPlaceholder","$customerPhone","customerPhonePlaceholder","$customerLine1","customerLine1Placeholder","$customerLine2","customerLine2Placeholder","$row3","$customerPostalCode","customerPostalCodePlaceholder","$customerCity","customerCityPlaceholder","$row4","$customerState","customerStatePlaceholder","$customerCountry","customerCountryPlaceholder","$publishStatus","$publish","textPublish","test","show","onPublished","module","exports","jQuery"],"mappings":"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","file":"voucherify.min.js","sourcesContent":["window.Voucherify = (function (window, document, $) {\n  \"use strict\";\n\n  var API_BASE = \"https://api.voucherify.io\";\n\n  var API = {\n      validate: API_BASE + \"/client/v1/validate\",\n      redeem:   API_BASE + \"/client/v1/redeem\",\n      publish:  API_BASE + \"/client/v1/publish\",\n      list:     API_BASE + \"/client/v1/vouchers\"\n  };\n\n  var OPTIONS = {};\n\n  // Error keys returned from voucherify API\n  var INVALID_AMOUNT = \"invalid_amount\";\n  var INVALID_NUMBER = \"invalid_number\";\n  var MISSING_AMOUNT = \"missing_amount\";\n  var INVALID_CUSTOMER_PHONE = \"invalid_customer_phone\";\n\n  var EMAIL_PATTERN = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n  function isValidResponseStructure(data) {\n    return data && (typeof(data.valid) === \"boolean\" // validate\n       || typeof(data.result) === \"string\" // redeem\n       || typeof(data.voucher) === \"object\" // publish\n       || typeof(data.vouchers) === \"object\" // list\n    );\n  }\n\n  var xhrImplementation = null;\n\n  if (!!$ && typeof($.ajax) === \"function\" && !!$.Deferred) {\n    xhrImplementation = function (method, url, payload, callback) {\n      var deferred = null;\n\n      if (typeof(callback) !== \"function\") {\n        deferred = $.Deferred();\n      }\n\n      $.ajax({\n        type: method,\n\n        url: url,\n\n        data: JSON.stringify(payload),\n\n        xhrFields: {\n          withCredentials: true\n        },\n\n        dataType: \"json\",\n        headers: {\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json\",\n          \"X-Client-Application-Id\": OPTIONS.applicationId,\n          \"X-Client-Token\": OPTIONS.token,\n          \"X-Voucherify-Channel\": \"Voucherify.js\"\n        },\n        timeout: OPTIONS.timeout,\n\n        success: function (data) {\n          var result = null;\n\n          if (isValidResponseStructure(data)) {\n            if (typeof(callback) === \"function\") {\n              callback(data);\n            } else {\n              deferred.resolve(data);\n            }\n          } else {\n            result = {\n              type: \"error\",\n              message: \"Unexpected response structure.\",\n              context: data\n            };\n\n            if (typeof(callback) === \"function\") {\n              callback(result);\n            } else {\n              deferred.reject(result);\n            }\n          }\n        },\n\n        error: function (error) {\n          var result = {\n            type: \"error\",\n            message: \"XHR error happened.\",\n            context: error\n          };\n\n          if (typeof(callback) === \"function\") {\n            callback(result);\n          } else {\n            deferred.reject(result);\n          }\n        }\n      });\n\n      if (typeof(callback) !== \"function\") {\n        return deferred.promise();\n      } else {\n        return undefined;\n      }\n    };\n  } else {\n    xhrImplementation = function (method, url, payload, callback) {\n      var request = new window.XMLHttpRequest();\n\n      request.withCredentials = true;\n      request.open(method, url, true);\n      request.timeout = OPTIONS.timeout;\n\n      request.setRequestHeader(\"Accept\", \"application/json\");\n      request.setRequestHeader(\"Content-Type\", \"application/json\");\n      request.setRequestHeader(\"X-Client-Application-Id\", OPTIONS.applicationId);\n      request.setRequestHeader(\"X-Client-Token\", OPTIONS.token);\n      request.setRequestHeader(\"X-Voucherify-Channel\", \"Voucherify.js\");\n\n      request.onload = function() {\n        var result = null;\n\n        if (request.status >= 200 && request.status < 400) {\n          var data = JSON.parse(request.responseText);\n\n          if (isValidResponseStructure(data)) {\n            if (typeof(callback) === \"function\") {\n              callback(data);\n            }\n          } else {\n            result = {\n              type: \"error\",\n              message: \"Unexpected response structure.\",\n              context: data\n            };\n\n            if (typeof(callback) === \"function\") {\n              callback(result);\n            }\n          }\n        } else {\n          result = {\n            type: \"error\",\n            message: \"Unexpected status code.\",\n            context: request.status\n          };\n\n          if (typeof(callback) === \"function\") {\n            callback(result);\n          }\n        }\n      };\n\n      request.onerror = function (error) {\n        var result = {\n          type: \"error\",\n          message: \"XHR error happened.\",\n          context: error\n        };\n\n        if (typeof(callback) === \"function\") {\n          callback(result);\n        }\n      };\n\n      request.send(JSON.stringify(payload));\n    };\n  }\n\n  function roundMoney(value) {\n    return Math.round(value * (100 + 0.001)) / 100;\n  }\n\n  function validatePercentDiscount(discount) {\n    if (!discount || discount < 0 || discount > 100) {\n      throw new Error('Invalid voucher, percent discount should be between 0-100.');\n    }\n  }\n\n  function validateAmountDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, amount discount must be higher than zero.\");\n    }\n  }\n\n  function validateUnitDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, unit discount must be higher than zero.\");\n    }\n  }\n\n  function isValidInit(options) {\n    if (!options.applicationId) {\n      console.error(\"Voucherify.js ERROR: Missing Client Application ID.\");\n      return false;\n    }\n    if (!options.applicationId) {\n      console.error(\"Voucherify.js ERROR: Missing Client Token (Secret Key).\");\n      return false;\n    }\n    return true;\n  }\n\n  var voucherify = {\n    initialize: function (clientAppId, token, timeout) {\n      OPTIONS.applicationId = clientAppId;\n      OPTIONS.token = token;\n      OPTIONS.timeout = timeout || 5000;\n    },\n\n    setIdentity: function (trackingId) {\n      OPTIONS.trackingId = trackingId;\n    },\n\n    validate: function (code, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      var amount;\n      var items;\n      var metadata;\n      var customer;\n\n      if (typeof(code) === \"object\") {\n        amount = code.amount;\n        items = code.items;\n        metadata = code.metadata;\n        customer = code.customer;\n        code = code.code;\n      }\n\n      if (!!code) {\n        code = code.replace(/[\\s\\r\\n]/g, \"\");\n      }\n\n      if (!code) {\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\n        return null;\n      }\n\n      var queryString = \"?code=\" + encodeURIComponent(code);\n\n      if (amount) {\n        queryString += \"&amount=\" + parseInt(amount); // in cents, amount=1000 means $10\n      }\n\n      if (items) {\n        queryString += \"&\" + items.map(function(item, index) {\n          return Object.keys(item).map(function(key) {\n            return encodeURIComponent(\"item[\" + index + \"][\" + key + \"]\") + \"=\" + encodeURIComponent(item[key]);\n          }).join(\"&\");\n        }).join(\"&\");\n      }\n\n      if (metadata) {\n        queryString += \"&\" + Object.keys(metadata).map(function(key) {\n          return encodeURIComponent(\"metadata[\" + key + \"]\") + \"=\" + encodeURIComponent(metadata[key]);\n        }).join(\"&\");\n      }\n\n      if (customer) {\n        queryString += \"&\" + Object.keys(customer).map(function(key) {\n          return encodeURIComponent(\"customer[\" + key + \"]\") + \"=\" + encodeURIComponent(customer[key]);\n        }).join(\"&\");\n      }\n\n      if (OPTIONS.trackingId) {\n        queryString += \"&tracking_id=\" + encodeURIComponent(OPTIONS.trackingId);\n      }\n\n      return xhrImplementation(\"GET\", API.validate + queryString, undefined, callback);\n    },\n\n    redeem: function (code, payload, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (!code) {\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\n        return null;\n      }\n\n      var queryString = \"?code=\" + encodeURIComponent(code.replace(/[\\s\\r\\n]/g, \"\"));\n\n      // -- Tracking ID fallback\n      payload = payload || {};\n      payload.customer = payload.customer || {};\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\n\n      return xhrImplementation(\"POST\", API.redeem + queryString, payload, callback);\n    },\n\n    publish: function (campaign, payload, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (!campaign) {\n        console.error(\"Voucherify.js ERROR: campaign is required to publish a voucher.\");\n        return null;\n      }\n\n      var queryString = \"?campaign=\" + encodeURIComponent(campaign);\n\n      // -- Tracking ID fallback\n      payload = payload || {};\n      payload.customer = payload.customer || {};\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\n      // -- Default channel\n      payload.channel = payload.channel || \"Voucherify.js\";\n\n      return xhrImplementation(\"POST\", API.publish + queryString, payload, callback);\n    },\n\n    listVouchers: function (filters, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (typeof filters === \"function\" && !callback) {\n        callback = filters;\n        filters = {};\n      }\n\n      var queryString = \"?\" + Object.keys(filters)\n              .map(function(key) {\n                return encodeURIComponent(key) + \"=\" + encodeURIComponent(filters[key])\n              })\n              .join(\"&\");\n\n      return xhrImplementation(\"GET\", API.list + queryString, undefined, callback);\n    },\n\n    utils: {\n      calculatePrice: function (basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (voucher.gift) {\n          discount = Math.min(voucher.gift.balance / e, basePrice);\n          return roundMoney(basePrice - discount);\n        }\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          var priceDiscount = basePrice * (discount / 100);\n          return roundMoney(basePrice - priceDiscount);\n\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var newPrice = basePrice - unitPrice * discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      },\n\n      calculateDiscount: function(basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (voucher.gift) {\n          discount = Math.min(voucher.gift.balance / e, basePrice);\n          return roundMoney(discount);\n        }\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          return roundMoney(basePrice * (discount / 100));\n\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? discount : basePrice);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var priceDiscount = unitPrice * discount;\n          return roundMoney(priceDiscount > basePrice ? basePrice : priceDiscount);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      }\n    },\n    render: function(selector, options) {\n      var $element = $(selector);\n      if (!$element || !$element.length) {\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\n      }\n      options = options || {};\n\n      function getCapitalizedName(name) {\n        return name.charAt(0).toUpperCase() + name.slice(1);\n      }\n\n      function getPropertyName(prefix, name) {\n        return prefix + getCapitalizedName(name);\n      }\n\n      function getConfigProperty(prefix, name) {\n        return options[getPropertyName(prefix, name)];\n      }\n\n      function create$control(type, name, $container, config) {\n        config = config || {};\n        var $control = null;\n        var configured$control = getConfigProperty(\"selector\", name);\n\n        if (config.configurable && configured$control) {\n          $control = $(configured$control);\n        }\n\n        if (!$control || !$control.length) {\n          $control = $(document.createElement(type));\n          $container.append($control);\n\n          for (var attribute in config) {\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\n              $control.attr(attribute, config[attribute]);\n            }\n          }\n\n          if (type === \"input\") {\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\n          }\n\n          if (type === \"span\" && config.text) {\n            $control.text(config.text);\n          }\n        }\n\n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\n        return $control;\n      }\n\n      var $container     = create$control(\"div\", \"container\", $element);\n      var $logoContainer = create$control(\"figure\", \"logo\", $container);\n      var $logo          = create$control(\"img\", \"logo\", $logoContainer, { src: typeof options.logoSrc === \"string\" ? options.logoSrc : \"https://app.voucherify.io/images/favicon.png\" });\n      var $code          = create$control(\"input\", \"code\", $container, { type: \"text\", placeholder: typeof options.textPlaceholder === \"string\" ? options.textPlaceholder : \"e.g. abc-123\" });\n      var $amount        = create$control(\"input\", \"amount\", $container, { type: options.amount ? \"text\" : \"hidden\", placeholder: typeof options.amountPlaceholder === \"string\" ? options.amountPlaceholder : \"e.g. 52.22\" });\n      var $discountType  = create$control(\"input\", \"discountType\", $container, { type: \"hidden\", configurable: true });\n      var $percentOff    = create$control(\"input\", \"percentOff\", $container, { type: \"hidden\", configurable: true });\n      var $amountOff     = create$control(\"input\", \"amountOff\", $container, { type: \"hidden\", configurable: true });\n      var $unitOff       = create$control(\"input\", \"unitOff\", $container, { type: \"hidden\", configurable: true });\n      var $tracking      = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\n      var $validate      = create$control(\"button\", \"validate\", $container, {});\n      var $validateText  = create$control(\"span\", \"validateText\", $validate, { text: typeof options.textValidate === \"string\" ? options.textValidate : \"Validate\" });\n\n      var self = this;\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\n\n      $code.on(\"keyup\", function(event) {\n        $code.toggleClass(classInvalidAnimation, false);\n      });\n\n      $amount.on(\"keyup\", function(event) {\n        $amount.toggleClass(classInvalidAnimation, false);\n      });\n\n      $validate.on(\"click\", function(event) {\n        $discountType.val(\"\");\n        $amountOff.val(\"\");\n        $unitOff.val(\"\");\n        $percentOff.val(\"\");\n        $tracking.val(\"\");\n\n        $validate.toggleClass(classInvalid, false);\n        $validate.toggleClass(classValid, false);\n\n        if (!$code.val()) {\n          $code.toggleClass(classInvalidAnimation, true)\n            .delay(1000)\n            .queue(function(){\n              $code.toggleClass(classInvalidAnimation, false);\n              $code.dequeue();\n            });\n          return;\n        }\n\n        var payload = {\n          code: $code.val(),\n          amount: parseInt(parseFloat($amount.val().replace(/\\,/, \".\")) * 100)\n        };\n\n        self.validate(payload, function(response) {\n          if (!response || !response.valid) {\n\n            var setFieldInvalid = function ($field) {\n              $field.toggleClass(classInvalid, true);\n              $field.toggleClass(classValid, false);\n              $field.toggleClass(classInvalidAnimation, true)\n              .delay(1000)\n              .queue(function(){\n                $field.toggleClass(classInvalidAnimation, false);\n                $field.dequeue();\n              });\n            };\n\n            $validate.toggleClass(classInvalid, true);\n            $validate.toggleClass(classValid, false);\n\n            var context         = response.context || {};\n            var responseJSON    = context.responseJSON || {};\n            var error_key       = responseJSON.key;\n\n            if (options.amount && (\n                error_key === INVALID_AMOUNT ||\n                error_key === INVALID_NUMBER ||\n                error_key === MISSING_AMOUNT)) {\n              setFieldInvalid($amount);\n            } else {\n              setFieldInvalid($code);\n            }\n            return;\n          }\n\n          if ($amount.val() >= 0) {\n            $amount.val(parseFloat($amount.val().replace(/\\,/, \".\")))\n          } else {\n            $amount.hide(100);\n          }\n\n          $code.toggleClass(classInvalid, false);\n          $amount.toggleClass(classInvalid, false);\n          $discountType.val(response.discount && response.discount.type || \"\");\n          $amountOff.val(response.discount && response.discount.amount_off || 0);\n          $unitOff.val(response.discount && response.discount.unit_off || 0);\n          $percentOff.val(response.discount && response.discount.percent_off || 0);\n          $tracking.val(response.tracking_id || \"\");\n\n          $code.prop(\"disabled\", true);\n          $amount.prop(\"disabled\", true);\n          $validate.prop(\"disabled\", true);\n\n          $code.toggleClass(classValid, true);\n          $amount.toggleClass(classValid, true);\n          $validate.toggleClass(classValid, true);\n          $validate.toggleClass(classInvalid, false);\n          $code.toggleClass(classInvalid, false);\n\n          $code.toggleClass(classValidAnimation, true);\n          $amount.toggleClass(classValidAnimation, true);\n\n          if (options && options.onValidated && typeof options.onValidated === \"function\") {\n            options.onValidated(response);\n          }\n        });\n      });\n    },\n\n    renderPublish : function (selector, options) {\n      var $element = $(selector);\n      if (!$element || !$element.length) {\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\n      }\n\n      options = options || {};\n\n      if (!options.campaignName) {\n        throw new Error(\"Option campaignName is not specified\");\n      }\n\n      function contains(arr, prop) {\n        return Array.prototype.some.call(arr || [], function (field) {\n          return field.name === prop;\n        });\n      }\n\n      function containsCustomer(prop) {\n          return contains(options.customerFields, prop);\n      }\n\n      function isRequired(prop) {\n          var field = Array.prototype.find.call(options.customerFields || [], function (field) {\n              return field.name === prop;\n          });\n\n          return field && field.required || false;\n      }\n\n      function getCapitalizedName(name) {\n        return name.charAt(0).toUpperCase() + name.slice(1);\n      }\n\n      function getPropertyName(prefix, name) {\n        return prefix + getCapitalizedName(name);\n      }\n\n      function getConfigProperty(prefix, name) {\n        return options[getPropertyName(prefix, name)];\n      }\n\n      function create$control(type, name, $container, config) {\n        config = config || {};\n        var $control = null;\n        var configured$control = getConfigProperty(\"selector\", name);\n\n        if (config.configurable && configured$control) {\n          $control = $(configured$control);\n        }\n\n        if (!$control || !$control.length) {\n          $control = $(document.createElement(type));\n          $container.append($control);\n\n          for (var attribute in config) {\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\n              $control.attr(attribute, config[attribute]);\n            }\n          }\n\n          if (type === \"input\") {\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\n          }\n\n          if (type === \"span\" && config.text) {\n            $control.text(config.text);\n          }\n        }\n\n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\n        return $control;\n      }\n\n      var $container     = create$control(\"div\", \"container\", $element);\n      $container.addClass(\"wide\");\n      var $logoContainer = create$control(\"figure\", \"logo\", $container);\n      var $logo          = create$control(\"img\", \"logo\", $logoContainer, { src: typeof options.logoSrc === \"string\" ? options.logoSrc : \"https://app.voucherify.io/images/favicon.png\" });\n\n      var $customerName  = containsCustomer(\"name\") && create$control(\"input\", \"customerName\", $container, { type: \"text\", placeholder: typeof options.customerNamePlaceholder === \"string\" ? options.customerNamePlaceholder : \"Name\" });\n      var $row1          = create$control(\"div\", \"row\", $container);\n      var $customerEmail = containsCustomer(\"email\") && create$control(\"input\", \"customerEmail\", $row1, { type: \"email\", placeholder: typeof options.customerEmailPlaceholder === \"string\" ? options.customerEmailPlaceholder : \"Email\" });\n      var $customerPhone = containsCustomer(\"phone\") && create$control(\"input\", \"customerPhone\", $row1, { type: \"text\", placeholder: typeof options.customerPhonePlaceholder === \"string\" ? options.customerPhonePlaceholder : \"Phone\" });\n      var $customerLine1 = containsCustomer(\"line_1\") && create$control(\"input\", \"customerLine1\", $container, { type: \"text\", placeholder: typeof options.customerLine1Placeholder === \"string\" ? options.customerLine1Placeholder : \"Address line 1\" });\n      var $customerLine2 = containsCustomer(\"line_2\") && create$control(\"input\", \"customerLine2\", $container, { type: \"text\", placeholder: typeof options.customerLine2Placeholder === \"string\" ? options.customerLine2Placeholder : \"Address line 2\" });\n      var $row3          = create$control(\"div\", \"row\", $container);\n      var $customerPostalCode = containsCustomer(\"postal_code\") && create$control(\"input\", \"customerPostalCode\", $row3, { type: \"text\", placeholder: typeof options.customerPostalCodePlaceholder === \"string\" ? options.customerPostalCodePlaceholder : \"Postal Code\" });\n      var $customerCity = containsCustomer(\"city\") && create$control(\"input\", \"customerCity\", $row3, { type: \"text\", placeholder: typeof options.customerCityPlaceholder === \"string\" ? options.customerCityPlaceholder : \"City\" });\n      var $row4          = create$control(\"div\", \"row\", $container);\n      var $customerState = containsCustomer(\"state\") && create$control(\"input\", \"customerState\", $row4, { type: \"text\", placeholder: typeof options.customerStatePlaceholder === \"string\" ? options.customerStatePlaceholder : \"State\" });\n      var $customerCountry = containsCustomer(\"country\") && create$control(\"input\", \"customerCountry\", $row4, { type: \"text\", placeholder: typeof options.customerCountryPlaceholder === \"string\" ? options.customerCountryPlaceholder : \"Country\" });\n\n      var $tracking      = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\n\n      var $publishStatus = create$control(\"input\", \"publishStatus\", $container, { type: \"text\" });\n\n      var $publish       = create$control(\"button\", \"publish\", $container, {});\n      var $publishText   = create$control(\"span\", \"publishText\", $publish, { text: typeof options.textPublish === \"string\" ? options.textPublish : \"Get voucher\" });\n\n      $publishStatus.prop(\"readonly\", true).hide();\n\n      var self = this;\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\n\n      function error$control($control) {\n        $control.toggleClass(classInvalid, true);\n        $control.toggleClass(classValid, false);\n        $control.toggleClass(classInvalidAnimation, true)\n          .delay(1000)\n          .queue(function(){\n            $control.toggleClass(classInvalidAnimation, false);\n            $control.toggleClass(classInvalid, false);\n            $control.toggleClass(classValid, false);\n            $control.dequeue();\n          });\n      }\n\n      $publish.on(\"click\", function(event) {\n        $tracking.val(\"\");\n\n        $publish.toggleClass(classInvalid, false);\n        $publish.toggleClass(classValid, false);\n\n        var payload = {\n          customer: {}\n        };\n\n        if (containsCustomer(\"name\")) {\n          if (!$customerName.val() && isRequired(\"name\")) {\n            return error$control($customerName);\n          }\n          payload.customer[\"name\"] = $customerName.val();\n        }\n\n        if (containsCustomer(\"email\")) {\n          if (!$customerEmail.val() && isRequired(\"email\")) {\n              return error$control($customerEmail);\n          }\n          if ($customerEmail.val() && !EMAIL_PATTERN.test($customerEmail.val())) {\n              return error$control($customerEmail);\n          }\n          payload.customer[\"email\"] = $customerEmail.val();\n          payload.customer[\"source_id\"] = payload.customer[\"email\"];\n        }\n\n        if (containsCustomer(\"phone\") ) {\n          if (!$customerPhone.val() && isRequired(\"phone\")) {\n              return error$control($customerPhone);\n          }\n          if ($customerPhone.val()) {\n            payload.customer[\"phone\"] = $customerPhone.val();\n          }\n        }\n\n        if (containsCustomer(\"line_1\") ||\n            containsCustomer(\"line_2\") ||\n            containsCustomer(\"postal_code\") ||\n            containsCustomer(\"city\") ||\n            containsCustomer(\"state\") ||\n            containsCustomer(\"country\")) {\n          payload.customer[\"address\"] = {};\n        }\n\n        if (containsCustomer(\"line_1\")) {\n          if (!$customerLine1.val() && isRequired(\"line_1\")) {\n            return error$control($customerLine1);\n          }\n          payload.customer[\"address\"][\"line_1\"] = $customerLine1.val();\n        }\n\n        if (containsCustomer(\"line_2\")) {\n          if (!$customerLine2.val() && isRequired(\"line_2\")) {\n            return error$control($customerLine2);\n          }\n          payload.customer[\"address\"][\"line_2\"] = $customerLine2.val();\n        }\n\n        if (containsCustomer(\"postal_code\")) {\n          if (!$customerPostalCode.val() && isRequired(\"postal_code\")) {\n            return error$control($customerPostalCode);\n          }\n          payload.customer[\"address\"][\"postal_code\"] = $customerPostalCode.val();\n        }\n\n        if (containsCustomer(\"city\")) {\n          if (!$customerCity.val() && isRequired(\"city\")) {\n            return error$control($customerCity);\n          }\n          payload.customer[\"address\"][\"city\"] = $customerCity.val();\n        }\n\n        if (containsCustomer(\"state\")) {\n          if (!$customerState.val() && isRequired(\"state\")) {\n            return error$control($customerState);\n          }\n          payload.customer[\"address\"][\"state\"] = $customerState.val();\n        }\n\n        if (containsCustomer(\"country\")) {\n          if (!$customerCountry.val() && isRequired(\"country\")) {\n            return error$control($customerCountry);\n          }\n          payload.customer[\"address\"][\"country\"] = $customerCountry.val()\n        }\n\n        self.publish(options.campaignName, payload, function(response) {\n          if (!response || !response.voucher || !response.voucher.code) {\n            var context         = response.context || {};\n            var responseJSON    = context.responseJSON || {};\n            var error_key       = responseJSON.key;\n\n            error$control($publish);\n\n            if (containsCustomer(\"phone\") && error_key === INVALID_CUSTOMER_PHONE) {\n              error$control($customerPhone);\n            }\n\n            return;\n          }\n\n          $customerName && $customerName.hide();\n          $customerEmail && $customerEmail.hide();\n          $customerPhone && $customerPhone.hide();\n          $customerLine1 && $customerLine1.hide();\n          $customerLine2 && $customerLine2.hide();\n          $customerPostalCode && $customerPostalCode.hide();\n          $customerCity && $customerCity.hide();\n          $customerState && $customerState.hide();\n          $customerCountry && $customerCountry.hide();\n\n          $publishStatus\n              .toggleClass(classValidAnimation, true)\n              .val(response.voucher.code).show(100);\n\n          $tracking.val(response.tracking_id || \"\");\n\n          $publish.prop(\"disabled\", true);\n\n          $publish\n              .toggleClass(classInvalid, false)\n              .hide();\n\n          if (options && options.onPublished && typeof options.onPublished === \"function\") {\n            options.onPublished(response);\n          }\n        });\n      });\n    }\n  };\n\n  function renderIframes() {\n    if (!window) {\n      return false;\n    }\n\n    var helpers = {\n      bind: function (element, name, callback) {\n        if (element.addEventListener) {\n          return element.addEventListener(name, callback, false)\n        } else {\n          return element.attachEvent(\"on\" + name, callback)\n        }\n      },\n      readOptions: function (element, allowed_options) {\n        return Array.prototype.reduce.call(allowed_options, function (options, allowed_option) {\n          var option_value = element.getAttribute(\"data-\" + allowed_option);\n\n          if (option_value) {\n            options[allowed_option] = option_value;\n          }\n\n          return options;\n        }, {});\n      },\n      encodeOptions: function (options) {\n        var query_parameters = [];\n\n        Object.keys(options).forEach(function(option_key) {\n          query_parameters.push(\"[options][\"+option_key+\"]=\"+encodeURIComponent(options[option_key]));\n        });\n\n        return \"?\" + query_parameters.join(\"&\");\n      }\n    };\n\n\n    function RenderIframe(element) {\n      var self = this;\n\n      self._host = \"https://app.voucherify.io\";\n      self._path = \"/widgets/publish\";\n\n      self._allowed_options = [\"client-app-id\", \"client-token\", \"campaign\", \"email-required\"];\n      self._element = element;\n\n      self._options = helpers.readOptions(self._element, self._allowed_options);\n\n      self._iframe = null;\n\n      return this.renderIframe();\n    }\n\n    RenderIframe.prototype.renderIframe = function () {\n      var self = this;\n\n      if (self._iframe) {\n        return self;\n      }\n\n      var css_props = [\n        \"width:400px;\",\n        \"height:450px;\",\n        \"background: transparent;\",\n        \"border: 0px none transparent;\",\n        \"overflow-x: hidden;\",\n        \"overflow-y: auto;\",\n        \"visibility: hidden;\",\n        \"margin: 0;\",\n        \"padding: 0;\",\n        \"-webkit-tap-highlight-color: transparent;\",\n        \"-webkit-touch-callout: none;\"\n      ];\n\n      self._iframe = document.createElement(\"iframe\");\n      self._iframe.setAttribute(\"frameBorder\", \"0\");\n      self._iframe.setAttribute(\"allowtransparency\", \"true\");\n      self._iframe.style.cssText = css_props.join(\"\\n\");\n\n      helpers.bind(self._iframe, \"load\", function () {\n        return self._iframe.style.visibility = \"visible\"\n      });\n\n      self._iframe.src = self._host + self._path + helpers.encodeOptions(self._options);\n\n      self._element.append(self._iframe);\n\n      return self;\n    };\n\n    var elements = window.document.querySelectorAll(\".voucherify-get-voucher\");\n\n    return Array.prototype.forEach.call(elements, function (element) {\n      return new RenderIframe(element);\n    })\n  }\n\n  renderIframes();\n\n  if (typeof module !== \"undefined\" && module.exports) {\n    module.exports = voucherify;\n  }\n\n  return voucherify;\n} (window, window.document, window.jQuery));\n"],"sourceRoot":"/source/"}