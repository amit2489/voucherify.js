{"version":3,"sources":["voucherify.js"],"names":["window","Voucherify","document","$","isValidResponseStructure","data","roundMoney","value","Math","round","validatePercentDiscount","discount","Error","validateAmountDiscount","validateUnitDiscount","isValidInit","options","applicationId","console","error","API_BASE","API","validate","redeem","publish","list","OPTIONS","INVALID_AMOUNT","INVALID_NUMBER","MISSING_AMOUNT","xhrImplementation","Deferred","method","url","payload","callback","deferred","ajax","type","JSON","stringify","xhrFields","withCredentials","dataType","headers","Accept","Content-Type","X-Client-Application-Id","X-Client-Token","token","X-Voucherify-Channel","timeout","success","result","resolve","message","context","reject","promise","undefined","request","XMLHttpRequest","open","setRequestHeader","onload","status","parse","responseText","onerror","send","voucherify","initialize","clientAppId","setIdentity","trackingId","code","amount","items","metadata","customer","replace","queryString","encodeURIComponent","parseInt","map","item","index","Object","keys","key","join","source_id","campaign","channel","listVouchers","filters","utils","calculatePrice","basePrice","voucher","unitPrice","e","gift","min","balance","percent_off","priceDiscount","amount_off","newPrice","unit_off","calculateDiscount","render","selector","getCapitalizedName","name","charAt","toUpperCase","slice","getPropertyName","prefix","getConfigProperty","create$control","$container","config","$control","configured$control","configurable","length","createElement","append","attribute","hasOwnProperty","attr","text","addClass","$element","$logoContainer","$code","src","logoSrc","placeholder","textPlaceholder","$amount","amountPlaceholder","$discountType","$percentOff","$amountOff","$unitOff","$tracking","$validate","self","textValidate","this","classInvalid","classValid","classInvalidAnimation","classValidAnimation","on","event","toggleClass","val","delay","queue","dequeue","parseFloat","response","valid","setFieldInvalid","$field","responseJSON","error_key","hide","tracking_id","prop","onValidated","module","exports","jQuery"],"mappings":"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","file":"voucherify.min.js","sourcesContent":["window.Voucherify = (function (window, document, $) {\n  \"use strict\";\n\n  var API_BASE = \"https://api.voucherify.io\";\n\n  var API = {\n      validate: API_BASE + \"/client/v1/validate\",\n      redeem:   API_BASE + \"/client/v1/redeem\",\n      publish:  API_BASE + \"/client/v1/publish\",\n      list:     API_BASE + \"/client/v1/vouchers\"\n  };\n\n  var OPTIONS = {};\n\n  // Error keys returned from voucherify API\n  var INVALID_AMOUNT = \"invalid_amount\";\n  var INVALID_NUMBER = \"invalid_number\";\n  var MISSING_AMOUNT = \"missing_amount\";\n\n  var xhrImplementation = null;\n\n  function isValidResponseStructure(data) {\n    return data && (typeof(data.valid) === \"boolean\" // validate\n       || typeof(data.result) === \"string\" // redeem\n       || typeof(data.voucher) === \"object\" // publish\n       || typeof(data.vouchers) === \"object\" // list\n    );\n  }\n\n  if (!!$ && typeof($.ajax) === \"function\" && !!$.Deferred) {\n    xhrImplementation = function (method, url, payload, callback) {\n      var deferred = null;\n\n      if (typeof(callback) !== \"function\") {\n        deferred = $.Deferred();\n      }\n\n      $.ajax({\n        type: method,\n\n        url: url,\n\n        data: JSON.stringify(payload),\n\n        xhrFields: {\n          withCredentials: true\n        },\n\n        dataType: \"json\",\n        headers: {\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json\",\n          \"X-Client-Application-Id\": OPTIONS.applicationId,\n          \"X-Client-Token\": OPTIONS.token,\n          \"X-Voucherify-Channel\": \"Voucherify.js\"\n        },\n        timeout: OPTIONS.timeout,\n\n        success: function (data) {\n          var result = null;\n\n          if (isValidResponseStructure(data)) {\n            if (typeof(callback) === \"function\") {\n              callback(data);\n            } else {\n              deferred.resolve(data);\n            }\n          } else {\n            result = {\n              type: \"error\",\n              message: \"Unexpected response structure.\",\n              context: data\n            };\n\n            if (typeof(callback) === \"function\") {\n              callback(result);\n            } else {\n              deferred.reject(result);\n            }\n          }\n        },\n\n        error: function (error) {\n          var result = {\n            type: \"error\",\n            message: \"XHR error happened.\",\n            context: error\n          };\n\n          if (typeof(callback) === \"function\") {\n            callback(result);\n          } else {\n            deferred.reject(result);\n          }\n        }\n      });\n\n      if (typeof(callback) !== \"function\") {\n        return deferred.promise();\n      } else {\n        return undefined;\n      }\n    };\n  } else {\n    xhrImplementation = function (method, url, payload, callback) {\n      var request = new window.XMLHttpRequest();\n\n      request.withCredentials = true;\n      request.open(method, url, true);\n      request.timeout = OPTIONS.timeout;\n\n      request.setRequestHeader(\"Accept\", \"application/json\");\n      request.setRequestHeader(\"Content-Type\", \"application/json\");\n      request.setRequestHeader(\"X-Client-Application-Id\", OPTIONS.applicationId);\n      request.setRequestHeader(\"X-Client-Token\", OPTIONS.token);\n      request.setRequestHeader(\"X-Voucherify-Channel\", \"Voucherify.js\");\n\n      request.onload = function() {\n        var result = null;\n\n        if (request.status >= 200 && request.status < 400) {\n          var data = JSON.parse(request.responseText);\n\n          if (isValidResponseStructure(data)) {\n            if (typeof(callback) === \"function\") {\n              callback(data);\n            }\n          } else {\n            result = {\n              type: \"error\",\n              message: \"Unexpected response structure.\",\n              context: data\n            };\n\n            if (typeof(callback) === \"function\") {\n              callback(result);\n            }\n          }\n        } else {\n          result = {\n            type: \"error\",\n            message: \"Unexpected status code.\",\n            context: request.status\n          };\n\n          if (typeof(callback) === \"function\") {\n            callback(result);\n          }\n        }\n      };\n\n      request.onerror = function (error) {\n        var result = {\n          type: \"error\",\n          message: \"XHR error happened.\",\n          context: error\n        };\n\n        if (typeof(callback) === \"function\") {\n          callback(result);\n        }\n      };\n\n      request.send(JSON.stringify(payload));\n    };\n  }\n\n  function roundMoney(value) {\n    return Math.round(value * (100 + 0.001)) / 100;\n  }\n\n  function validatePercentDiscount(discount) {\n    if (!discount || discount < 0 || discount > 100) {\n      throw new Error('Invalid voucher, percent discount should be between 0-100.');\n    }\n  }\n\n  function validateAmountDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, amount discount must be higher than zero.\");\n    }\n  }\n\n  function validateUnitDiscount(discount) {\n    if (!discount || discount < 0) {\n      throw new Error(\"Invalid voucher, unit discount must be higher than zero.\");\n    }\n  }\n\n  function isValidInit(options) {\n    if (!options.applicationId) {\n      console.error(\"Voucherify.js ERROR: Missing Client Application ID.\");\n      return false;\n    }\n    if (!options.applicationId) {\n      console.error(\"Voucherify.js ERROR: Missing Client Token (Secret Key).\");\n      return false;\n    }\n    return true;\n  }\n\n  var voucherify = {\n    initialize: function (clientAppId, token, timeout) {\n      OPTIONS.applicationId = clientAppId;\n      OPTIONS.token = token;\n      OPTIONS.timeout = timeout || 5000;\n    },\n\n    setIdentity: function (trackingId) {\n      OPTIONS.trackingId = trackingId;\n    },\n\n    validate: function (code, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      var amount;\n      var items;\n      var metadata;\n      var customer;\n\n      if (typeof(code) === \"object\") {\n        amount = code.amount;\n        items = code.items;\n        metadata = code.metadata;\n        customer = code.customer;\n        code = code.code;\n      }\n\n      if (!!code) {\n        code = code.replace(/[\\s\\r\\n]/g, \"\");\n      }\n\n      if (!code) {\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\n        return null;\n      }\n\n      var queryString = \"?code=\" + encodeURIComponent(code);\n\n      if (amount) {\n        queryString += \"&amount=\" + parseInt(amount); // in cents, amount=1000 means $10\n      }\n\n      if (items) {\n        queryString += \"&\" + items.map(function(item, index) {\n          return Object.keys(item).map(function(key) {\n            return encodeURIComponent(\"item[\" + index + \"][\" + key + \"]\") + \"=\" + encodeURIComponent(item[key]);\n          }).join(\"&\");\n        }).join(\"&\");\n      }\n\n      if (metadata) {\n        queryString += \"&\" + Object.keys(metadata).map(function(key) {\n          return encodeURIComponent(\"metadata[\" + key + \"]\") + \"=\" + encodeURIComponent(metadata[key]);\n        }).join(\"&\");\n      }\n\n      if (customer) {\n        queryString += \"&\" + Object.keys(customer).map(function(key) {\n          return encodeURIComponent(\"customer[\" + key + \"]\") + \"=\" + encodeURIComponent(customer[key]);\n        }).join(\"&\");\n      }\n\n      if (OPTIONS.trackingId) {\n        queryString += \"&tracking_id=\" + encodeURIComponent(OPTIONS.trackingId);\n      }\n\n      return xhrImplementation(\"GET\", API.validate + queryString, undefined, callback);\n    },\n\n    redeem: function (code, payload, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (!code) {\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\n        return null;\n      }\n\n      var queryString = \"?code=\" + encodeURIComponent(code.replace(/[\\s\\r\\n]/g, \"\"));\n\n      // -- Tracking ID fallback\n      payload = payload || {};\n      payload.customer = payload.customer || {};\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\n\n      return xhrImplementation(\"POST\", API.redeem + queryString, payload, callback);\n    },\n\n    publish: function (campaign, payload, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (!campaign) {\n        console.error(\"Voucherify.js ERROR: campaign is required to publish a voucher.\");\n        return null;\n      }\n\n      var queryString = \"?campaign=\" + encodeURIComponent(campaign);\n\n      // -- Tracking ID fallback\n      payload = payload || {};\n      payload.customer = payload.customer || {};\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\n      // -- Default channel\n      payload.channel = payload.channel || \"Voucherify.js\";\n\n      return xhrImplementation(\"POST\", API.publish + queryString, payload, callback);\n    },\n\n    listVouchers: function (filters, callback) {\n      if (!isValidInit(OPTIONS)) {\n        return null;\n      }\n\n      if (typeof filters === \"function\" && !callback) {\n        callback = filters;\n        filters = {};\n      }\n\n      var queryString = \"?\" + Object.keys(filters)\n              .map(function(key) {\n                return encodeURIComponent(key) + \"=\" + encodeURIComponent(filters[key])\n              })\n              .join(\"&\");\n\n      return xhrImplementation(\"GET\", API.list + queryString, undefined, callback);\n    },\n\n    utils: {\n      calculatePrice: function (basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (voucher.gift) {\n          discount = Math.min(voucher.gift.balance / e, basePrice);\n          return roundMoney(basePrice - discount);\n        }\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          var priceDiscount = basePrice * (discount / 100);\n          return roundMoney(basePrice - priceDiscount);\n\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var newPrice = basePrice - unitPrice * discount;\n          return roundMoney(newPrice > 0 ? newPrice : 0);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      },\n\n      calculateDiscount: function(basePrice, voucher, unitPrice) {\n        var e = 100; // Number of digits after the decimal separator.\n        var discount;\n\n        if (voucher.gift) {\n          discount = Math.min(voucher.gift.balance / e, basePrice);\n          return roundMoney(discount);\n        }\n\n        if (!voucher.discount) {\n          throw new Error(\"Unsupported voucher type.\");\n        }\n\n        if (voucher.discount.type === 'PERCENT') {\n          discount = voucher.discount.percent_off;\n          validatePercentDiscount(discount);\n          return roundMoney(basePrice * (discount / 100));\n\n        } else if (voucher.discount.type === 'AMOUNT') {\n          discount = voucher.discount.amount_off / e;\n          validateAmountDiscount(discount);\n          var newPrice = basePrice - discount;\n          return roundMoney(newPrice > 0 ? discount : basePrice);\n\n        } else if (voucher.discount.type === 'UNIT') {\n          discount = voucher.discount.unit_off;\n          validateUnitDiscount(discount);\n          var priceDiscount = unitPrice * discount;\n          return roundMoney(priceDiscount > basePrice ? basePrice : priceDiscount);\n\n        } else {\n          throw new Error(\"Unsupported discount type.\");\n        }\n      }\n    },\n    render: function(selector, options) {\n      var $element = $(selector);\n      if (!$element || !$element.length) {\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\n      }\n      options = options || {};\n\n      function getCapitalizedName(name) {\n        return name.charAt(0).toUpperCase() + name.slice(1);\n      }\n\n      function getPropertyName(prefix, name) {\n        return prefix + getCapitalizedName(name);\n      }\n\n      function getConfigProperty(prefix, name) {\n        return options[getPropertyName(prefix, name)];\n      }\n\n      function create$control(type, name, $container, config) {\n        config = config || {};\n        var $control = null;\n        var configured$control = getConfigProperty(\"selector\", name);\n\n        if (config.configurable && configured$control) {\n          $control = $(configured$control);\n        }\n\n        if (!$control || !$control.length) {\n          $control = $(document.createElement(type));\n          $container.append($control);\n\n          for (var attribute in config) {\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\n              $control.attr(attribute, config[attribute]);\n            }\n          }\n\n          if (type === \"input\") {\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\n          }\n\n          if (type === \"span\" && config.text) {\n            $control.text(config.text);\n          }\n        }\n\n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\n        return $control;\n      }\n\n      var $container     = create$control(\"div\", \"container\", $element);\n      var $logoContainer = create$control(\"figure\", \"logo\", $container);\n      var $logo          = create$control(\"img\", \"logo\", $logoContainer, { src: typeof options.logoSrc === \"string\" ? options.logoSrc : \"https://app.voucherify.io/images/favicon.png\" });\n      var $code          = create$control(\"input\", \"code\", $container, { type: \"text\", placeholder: typeof options.textPlaceholder === \"string\" ? options.textPlaceholder : \"e.g. abc-123\" });\n      var $amount        = create$control(\"input\", \"amount\", $container, { type: options.amount ? \"text\" : \"hidden\", placeholder: typeof options.amountPlaceholder === \"string\" ? options.amountPlaceholder : \"e.g. 52.22\" });\n      var $discountType  = create$control(\"input\", \"discountType\", $container, { type: \"hidden\", configurable: true });\n      var $percentOff    = create$control(\"input\", \"percentOff\", $container, { type: \"hidden\", configurable: true });\n      var $amountOff     = create$control(\"input\", \"amountOff\", $container, { type: \"hidden\", configurable: true });\n      var $unitOff       = create$control(\"input\", \"unitOff\", $container, { type: \"hidden\", configurable: true });\n      var $tracking      = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\n      var $validate      = create$control(\"button\", \"validate\", $container, {});\n      var $validateText  = create$control(\"span\", \"validateText\", $validate, { text: typeof options.textValidate === \"string\" ? options.textValidate : \"Validate\" });\n\n      var self = this;\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\n\n      $code.on(\"keyup\", function(event) {\n        $code.toggleClass(classInvalidAnimation, false);\n      });\n\n      $amount.on(\"keyup\", function(event) {\n        $amount.toggleClass(classInvalidAnimation, false);\n      });\n\n      $validate.on(\"click\", function(event) {\n        $discountType.val(\"\");\n        $amountOff.val(\"\");\n        $unitOff.val(\"\");\n        $percentOff.val(\"\");\n        $tracking.val(\"\");\n\n        $validate.toggleClass(classInvalid, false);\n        $validate.toggleClass(classValid, false);\n\n        if (!$code.val()) {\n          $code.toggleClass(classInvalidAnimation, true)\n            .delay(1000)\n            .queue(function(){\n              $code.toggleClass(classInvalidAnimation, false);\n              $code.dequeue();\n            });\n          return;\n        }\n\n        var payload = {\n          code: $code.val(),\n          amount: parseInt(parseFloat($amount.val().replace(/\\,/, \".\")) * 100)\n        };\n\n        self.validate(payload, function(response) {\n          if (!response || !response.valid) {\n\n            var setFieldInvalid = function ($field) {\n              $field.toggleClass(classInvalid, true);\n              $field.toggleClass(classValid, false);\n              $field.toggleClass(classInvalidAnimation, true)\n                .delay(1000)\n                .queue(function(){\n                  $field.toggleClass(classInvalidAnimation, false);\n                  $field.dequeue();\n                });\n            };\n\n            $validate.toggleClass(classInvalid, true);\n            $validate.toggleClass(classValid, false);\n\n            var context         = response.context || {};\n            var responseJSON    = context.responseJSON || {};\n            var error_key       = responseJSON.key;\n\n            if (options.amount && (\n                error_key === INVALID_AMOUNT ||\n                error_key === INVALID_NUMBER ||\n                error_key === MISSING_AMOUNT)) {\n              setFieldInvalid($amount);\n            } else {\n              setFieldInvalid($code);\n            }\n\n            return;\n          }\n\n          if ($amount.val() >= 0) {\n            $amount.val(parseFloat($amount.val().replace(/\\,/, \".\")))\n          } else {\n            $amount.hide(100);\n          }\n\n          $code.toggleClass(classInvalid, false);\n          $amount.toggleClass(classInvalid, false);\n          $discountType.val(response.discount && response.discount.type || \"\");\n          $amountOff.val(response.discount && response.discount.amount_off || 0);\n          $unitOff.val(response.discount && response.discount.unit_off || 0);\n          $percentOff.val(response.discount && response.discount.percent_off || 0);\n          $tracking.val(response.tracking_id || \"\");\n\n          $code.prop(\"disabled\", true);\n          $amount.prop(\"disabled\", true);\n          $validate.prop(\"disabled\", true);\n\n          $code.toggleClass(classValid, true);\n          $amount.toggleClass(classValid, true);\n          $validate.toggleClass(classValid, true);\n          $validate.toggleClass(classInvalid, false);\n          $code.toggleClass(classInvalid, false);\n\n          $code.toggleClass(classValidAnimation, true);\n          $amount.toggleClass(classValidAnimation, true);\n\n          if (options && options.onValidated && typeof options.onValidated === \"function\") {\n            options.onValidated(response);\n          }\n        });\n      });\n    }\n  };\n\n  if (typeof module !== \"undefined\" && module.exports) {\n    module.exports = voucherify;\n  }\n\n  return voucherify;\n} (window, window.document, window.jQuery));\n"],"sourceRoot":"/source/"}