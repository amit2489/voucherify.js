{"version":3,"sources":["voucherify.js"],"names":["window","Voucherify","document","$","roundMoney","value","Math","round","validatePercentDiscount","discount","Error","validateAmountDiscount","validateUnitDiscount","isValidInit","options","applicationId","console","error","API_BASE","API","validate","redeem","publish","OPTIONS","xhrImplementation","Deferred","method","url","payload","callback","deferred","ajax","type","data","JSON","stringify","xhrFields","withCredentials","dataType","headers","Accept","Content-Type","X-Client-Application-Id","X-Client-Token","token","X-Voucherify-Channel","timeout","success","result","message","context","reject","resolve","promise","undefined","request","XMLHttpRequest","open","setRequestHeader","onload","status","parse","responseText","onerror","send","voucherify","initialize","clientAppId","setIdentity","trackingId","code","amount","items","metadata","customer","replace","queryString","encodeURIComponent","parseInt","map","item","index","Object","keys","key","join","source_id","campaign","channel","utils","calculatePrice","basePrice","voucher","unitPrice","e","gift","min","balance","percent_off","priceDiscount","amount_off","newPrice","unit_off","calculateDiscount","render","selector","getCapitalizedName","name","charAt","toUpperCase","slice","getPropertyName","prefix","getConfigProperty","create$control","$container","config","$control","configured$control","configurable","length","createElement","append","attribute","hasOwnProperty","attr","text","addClass","$element","$logoContainer","$code","src","logoSrc","placeholder","textPlaceholder","$discountType","$percentOff","$amountOff","$unitOff","$tracking","$validate","self","textValidate","this","classInvalid","classValid","classInvalidAnimation","classValidAnimation","on","event","toggleClass","val","response","valid","tracking_id","prop","onValidated","delay","queue","dequeue","module","exports","jQuery"],"mappings":"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","file":"voucherify.min.js","sourcesContent":["window.Voucherify = (function (window, document, $) {\r\n  \"use strict\";\r\n\r\n  var API_BASE = \"https://api.voucherify.io\";\r\n\r\n  var API = {\r\n      validate: API_BASE + \"/client/v1/validate\",\r\n      redeem:   API_BASE + \"/client/v1/redeem\",\r\n      publish:  API_BASE + \"/client/v1/publish\"\r\n  };\r\n\r\n  var OPTIONS = {};\r\n\r\n  var xhrImplementation = null;\r\n\r\n  if (!!$ && typeof($.ajax) === \"function\" && !!$.Deferred) {\r\n    xhrImplementation = function (method, url, payload, callback) {\r\n      var deferred = null;\r\n\r\n      if (typeof(callback) !== \"function\") {\r\n        deferred = $.Deferred();\r\n      }\r\n\r\n      $.ajax({\r\n        type: method,\r\n\r\n        url: url,\r\n\r\n        data: JSON.stringify(payload),\r\n\r\n        xhrFields: {\r\n          withCredentials: true\r\n        },\r\n\r\n        dataType: \"json\",\r\n        headers: {\r\n          \"Accept\": \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n          \"X-Client-Application-Id\": OPTIONS.applicationId,\r\n          \"X-Client-Token\": OPTIONS.token,\r\n          \"X-Voucherify-Channel\": \"Voucherify.js\"\r\n        },\r\n        timeout: OPTIONS.timeout,\r\n\r\n        success: function (data) {\r\n          var result = null;\r\n\r\n          if (data && (typeof(data.valid) === \"boolean\" || typeof(data.result) === \"string\")) {\r\n            if (typeof(callback) === \"function\") {\r\n              callback(data);\r\n            } else {\r\n              deferred.resolve(data);\r\n            }\r\n          } else {\r\n            result = {\r\n              type: \"error\",\r\n              message: \"Unexpected response structure.\",\r\n              context: data\r\n            };\r\n\r\n            if (typeof(callback) === \"function\") {\r\n              callback(result);\r\n            } else {\r\n              deferred.reject(result);\r\n            }\r\n          }\r\n        },\r\n\r\n        error: function (error) {\r\n          var result = {\r\n            type: \"error\",\r\n            message: \"XHR error happened.\",\r\n            context: error\r\n          };\r\n\r\n          if (typeof(callback) === \"function\") {\r\n            callback(result);\r\n          } else {\r\n            deferred.reject(result);\r\n          }\r\n        }\r\n      });\r\n\r\n      if (typeof(callback) !== \"function\") {\r\n        return deferred.promise();\r\n      } else {\r\n        return undefined;\r\n      }\r\n    };\r\n  } else {\r\n    xhrImplementation = function (method, url, payload, callback) {\r\n      var request = new window.XMLHttpRequest();\r\n\r\n      request.withCredentials = true;\r\n      request.open(method, url, true);\r\n      request.timeout = OPTIONS.timeout;\r\n\r\n      request.setRequestHeader(\"Accept\", \"application/json\");\r\n      request.setRequestHeader(\"Content-Type\", \"application/json\");\r\n      request.setRequestHeader(\"X-Client-Application-Id\", OPTIONS.applicationId);\r\n      request.setRequestHeader(\"X-Client-Token\", OPTIONS.token);\r\n      request.setRequestHeader(\"X-Voucherify-Channel\", \"Voucherify.js\");\r\n\r\n      request.onload = function() {\r\n        var result = null;\r\n\r\n        if (request.status >= 200 && request.status < 400) {\r\n          var data = JSON.parse(request.responseText);\r\n\r\n          if (data && (typeof(data.valid) === \"boolean\" || typeof(data.result) === \"string\")) {\r\n            if (typeof(callback) === \"function\") {\r\n              callback(data);\r\n            }\r\n          } else {\r\n            result = {\r\n              type: \"error\",\r\n              message: \"Unexpected response structure.\",\r\n              context: data\r\n            };\r\n\r\n            if (typeof(callback) === \"function\") {\r\n              callback(result);\r\n            }\r\n          }\r\n        } else {\r\n          result = {\r\n            type: \"error\",\r\n            message: \"Unexpected status code.\",\r\n            context: request.status\r\n          };\r\n\r\n          if (typeof(callback) === \"function\") {\r\n            callback(result);\r\n          }\r\n        }\r\n      };\r\n\r\n      request.onerror = function (error) {\r\n        var result = {\r\n          type: \"error\",\r\n          message: \"XHR error happened.\",\r\n          context: error\r\n        };\r\n\r\n        if (typeof(callback) === \"function\") {\r\n          callback(result);\r\n        }\r\n      };\r\n\r\n      request.send(JSON.stringify(payload));\r\n    };\r\n  }\r\n\r\n  function roundMoney(value) {\r\n    return Math.round(value * (100 + 0.001)) / 100;\r\n  }\r\n\r\n  function validatePercentDiscount(discount) {\r\n    if (!discount || discount < 0 || discount > 100) {\r\n      throw new Error('Invalid voucher, percent discount should be between 0-100.');\r\n    }\r\n  }\r\n\r\n  function validateAmountDiscount(discount) {\r\n    if (!discount || discount < 0) {\r\n      throw new Error(\"Invalid voucher, amount discount must be higher than zero.\");\r\n    }\r\n  }\r\n\r\n  function validateUnitDiscount(discount) {\r\n    if (!discount || discount < 0) {\r\n      throw new Error(\"Invalid voucher, unit discount must be higher than zero.\");\r\n    }\r\n  }\r\n\r\n  function isValidInit(options) {\r\n    if (!options.applicationId) {\r\n      console.error(\"Voucherify.js ERROR: Missing Client Application ID.\");\r\n      return false;\r\n    }\r\n    if (!options.applicationId) {\r\n      console.error(\"Voucherify.js ERROR: Missing Client Token (Secret Key).\");\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  var voucherify = {\r\n    initialize: function (clientAppId, token, timeout) {\r\n      OPTIONS.applicationId = clientAppId;\r\n      OPTIONS.token = token;\r\n      OPTIONS.timeout = timeout || 5000;\r\n    },\r\n\r\n    setIdentity: function (trackingId) {\r\n      OPTIONS.trackingId = trackingId;\r\n    },\r\n\r\n    validate: function (code, callback) {\r\n      if (!isValidInit(OPTIONS)) {\r\n        return null;\r\n      }\r\n\r\n      var amount;\r\n      var items;\r\n      var metadata;\r\n      var customer;\r\n\r\n      if (typeof(code) === \"object\") {\r\n        amount = code.amount;\r\n        items = code.items;\r\n        metadata = code.metadata;\r\n        customer = code.customer;\r\n        code = code.code;\r\n      }\r\n\r\n      if (!!code) {\r\n        code = code.replace(/[\\s\\r\\n]/g, \"\");\r\n      }\r\n\r\n      if (!code) {\r\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\r\n        return null;\r\n      }\r\n\r\n      var queryString = \"?code=\" + encodeURIComponent(code);\r\n\r\n      if (amount) {\r\n        queryString += \"&amount=\" + parseInt(amount); // in cents, amount=1000 means $10\r\n      }\r\n\r\n      if (items) {\r\n        queryString += \"&\" + items.map(function(item, index) {\r\n          return Object.keys(item).map(function(key) {\r\n            return encodeURIComponent(\"item[\" + index + \"][\" + key + \"]\") + \"=\" + encodeURIComponent(item[key]);\r\n          }).join(\"&\");\r\n        }).join(\"&\");\r\n      }\r\n\r\n      if (metadata) {\r\n        queryString += \"&\" + Object.keys(metadata).map(function(key) {\r\n          return encodeURIComponent(\"metadata[\" + key + \"]\") + \"=\" + encodeURIComponent(metadata[key]);\r\n        }).join(\"&\");\r\n      }\r\n\r\n      if (customer) {\r\n        queryString += \"&\" + Object.keys(customer).map(function(key) {\r\n          return encodeURIComponent(\"customer[\" + key + \"]\") + \"=\" + encodeURIComponent(customer[key]);\r\n        }).join(\"&\");\r\n      }\r\n\r\n      if (OPTIONS.trackingId) {\r\n        queryString += \"&tracking_id=\" + encodeURIComponent(OPTIONS.trackingId);\r\n      }\r\n\r\n      return xhrImplementation(\"GET\", API.validate + queryString, undefined, callback);\r\n    },\r\n\r\n    redeem: function (code, payload, callback) {\r\n      if (!isValidInit(OPTIONS)) {\r\n        return null;\r\n      }\r\n\r\n      if (!code) {\r\n        console.error(\"Voucherify client could not verify code, because it is missing - please provide Voucher Code.\");\r\n        return null;\r\n      }\r\n\r\n      var queryString = \"?code=\" + encodeURIComponent(code.replace(/[\\s\\r\\n]/g, \"\"));\r\n\r\n      // -- Tracking ID fallback\r\n      payload = payload || {};\r\n      payload.customer = payload.customer || {};\r\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\r\n\r\n      return xhrImplementation(\"POST\", API.redeem + queryString, payload, callback);\r\n    },\r\n\r\n    publish: function (campaign, payload, callback) {\r\n      if (!isValidInit(OPTIONS)) {\r\n        return null;\r\n      }\r\n\r\n      if (!campaign) {\r\n        console.error(\"Voucherify.js ERROR: campaign is required to publish a voucher.\");\r\n        return null;\r\n      }\r\n\r\n      var queryString = \"?campaign=\" + encodeURIComponent(campaign);\r\n\r\n      // -- Tracking ID fallback\r\n      payload = payload || {};\r\n      payload.customer = payload.customer || {};\r\n      payload.customer.source_id = payload.customer.source_id || OPTIONS.trackingId;\r\n      payload.channel = payload.channel || \"Voucherify.js\";\r\n\r\n      return xhrImplementation(\"POST\", API.publish + queryString, payload, callback);\r\n    },\r\n\r\n    utils: {\r\n      calculatePrice: function (basePrice, voucher, unitPrice) {\r\n        var e = 100; // Number of digits after the decimal separator.\r\n        var discount;\r\n\r\n        if (voucher.gift) {\r\n          discount = Math.min(voucher.gift.balance / e, basePrice);\r\n          return roundMoney(basePrice - discount);\r\n        }\r\n\r\n        if (!voucher.discount) {\r\n          throw new Error(\"Unsupported voucher type.\");\r\n        }\r\n\r\n        if (voucher.discount.type === 'PERCENT') {\r\n          discount = voucher.discount.percent_off;\r\n          validatePercentDiscount(discount);\r\n          var priceDiscount = basePrice * (discount / 100);\r\n          return roundMoney(basePrice - priceDiscount);\r\n\r\n        } else if (voucher.discount.type === 'AMOUNT') {\r\n          discount = voucher.discount.amount_off / e;\r\n          validateAmountDiscount(discount);\r\n          var newPrice = basePrice - discount;\r\n          return roundMoney(newPrice > 0 ? newPrice : 0);\r\n\r\n        } else if (voucher.discount.type === 'UNIT') {\r\n          discount = voucher.discount.unit_off;\r\n          validateUnitDiscount(discount);\r\n          var newPrice = basePrice - unitPrice * discount;\r\n          return roundMoney(newPrice > 0 ? newPrice : 0);\r\n\r\n        } else {\r\n          throw new Error(\"Unsupported discount type.\");\r\n        }\r\n      },\r\n\r\n      calculateDiscount: function(basePrice, voucher, unitPrice) {\r\n        var e = 100; // Number of digits after the decimal separator.\r\n        var discount;\r\n\r\n        if (voucher.gift) {\r\n          discount = Math.min(voucher.gift.balance / e, basePrice);\r\n          return roundMoney(discount);\r\n        }\r\n\r\n        if (!voucher.discount) {\r\n          throw new Error(\"Unsupported voucher type.\");\r\n        }\r\n\r\n        if (voucher.discount.type === 'PERCENT') {\r\n          discount = voucher.discount.percent_off;\r\n          validatePercentDiscount(discount);\r\n          return roundMoney(basePrice * (discount / 100));\r\n\r\n        } else if (voucher.discount.type === 'AMOUNT') {\r\n          discount = voucher.discount.amount_off / e;\r\n          validateAmountDiscount(discount);\r\n          var newPrice = basePrice - discount;\r\n          return roundMoney(newPrice > 0 ? discount : basePrice);\r\n\r\n        } else if (voucher.discount.type === 'UNIT') {\r\n          discount = voucher.discount.unit_off;\r\n          validateUnitDiscount(discount);\r\n          var priceDiscount = unitPrice * discount;\r\n          return roundMoney(priceDiscount > basePrice ? basePrice : priceDiscount);\r\n\r\n        } else {\r\n          throw new Error(\"Unsupported discount type.\");\r\n        }\r\n      }\r\n    },\r\n    render: function(selector, options) {\r\n      var $element = $(selector);\r\n      if (!$element || !$element.length) {\r\n        throw new Error(\"Element '\" + selector + \"' cannot be found\");\r\n      }\r\n      options = options || {};\r\n\r\n      function getCapitalizedName(name) {\r\n        return name.charAt(0).toUpperCase() + name.slice(1);\r\n      }\r\n\r\n      function getPropertyName(prefix, name) {\r\n        return prefix + getCapitalizedName(name);\r\n      }\r\n\r\n      function getConfigProperty(prefix, name) {\r\n        return options[getPropertyName(prefix, name)];\r\n      }\r\n\r\n      function create$control(type, name, $container, config) {\r\n        config = config || {};\r\n        var $control = null;\r\n        var configured$control = getConfigProperty(\"selector\", name);\r\n\r\n        if (config.configurable && configured$control) {\r\n          $control = $(configured$control);\r\n        }\r\n\r\n        if (!$control || !$control.length) {\r\n          $control = $(document.createElement(type));\r\n          $container.append($control);\r\n\r\n          for (var attribute in config) {\r\n            if (attribute !== \"configurable\" && config.hasOwnProperty(attribute)) {\r\n              $control.attr(attribute, config[attribute]);\r\n            }\r\n          }\r\n\r\n          if (type === \"input\") {\r\n            $control.attr(\"name\", getPropertyName(\"voucherify\", name));\r\n          }\r\n\r\n          if (type === \"span\" && config.text) {\r\n            $control.text(config.text);\r\n          }\r\n        }\r\n\r\n        $control.addClass(typeof getConfigProperty(\"class\", name) === \"string\" ? getConfigProperty(\"class\", name) : getPropertyName(\"voucherify\", name));\r\n        return $control;\r\n      }\r\n\r\n      var $container     = create$control(\"div\", \"container\", $element);\r\n      var $logoContainer = create$control(\"figure\", \"logo\", $container);\r\n      var $logo          = create$control(\"img\", \"logo\", $logoContainer, { src: typeof options.logoSrc === \"string\" ? options.logoSrc : \"https://app.voucherify.io/images/favicon.png\" });\r\n      var $code          = create$control(\"input\", \"code\", $container, { type: \"text\", placeholder: typeof options.textPlaceholder === \"string\" ? options.textPlaceholder : \"e.g. abc-123\" });\r\n      var $discountType  = create$control(\"input\", \"discountType\", $container, { type: \"hidden\", configurable: true });\r\n      var $percentOff    = create$control(\"input\", \"percentOff\", $container, { type: \"hidden\", configurable: true });\r\n      var $amountOff     = create$control(\"input\", \"amountOff\", $container, { type: \"hidden\", configurable: true });\r\n      var $unitOff       = create$control(\"input\", \"unitOff\", $container, { type: \"hidden\", configurable: true });\r\n      var $tracking      = create$control(\"input\", \"tracking\", $container, { type: \"hidden\", configurable: true });\r\n      var $validate      = create$control(\"button\", \"validate\", $container, {});\r\n      var $validateText  = create$control(\"span\", \"validateText\", $validate, { text: typeof options.textValidate === \"string\" ? options.textValidate : \"Validate\" });\r\n\r\n      var self = this;\r\n      var classInvalid = options.classInvalid === \"string\" ? options.classInvalid : \"voucherifyInvalid\";\r\n      var classValid = typeof options.classValid === \"string\" ? options.classValid : \"voucherifyValid\";\r\n      var classInvalidAnimation = options.classInvalidAnimation === \"string\" ? options.classInvalidAnimation : \"voucherifyAnimationShake\";\r\n      var classValidAnimation = options.classValidAnimation === \"string\" ? options.classValidAnimation : \"voucherifyAnimationTada\";\r\n\r\n      $code.on(\"keyup\", function(event) {\r\n        $code.toggleClass(classInvalidAnimation, false);\r\n      });\r\n\r\n      $validate.on(\"click\", function(event) {\r\n        $discountType.val(\"\");\r\n        $amountOff.val(\"\");\r\n        $unitOff.val(\"\");\r\n        $percentOff.val(\"\");\r\n        $tracking.val(\"\");\r\n\r\n        $validate.toggleClass(classInvalid, false);\r\n        $validate.toggleClass(classValid, false);\r\n\r\n        if (!$code.val()) {\r\n          $code.toggleClass(classInvalidAnimation, true)\r\n              .delay(1000)\r\n              .queue(function(){\r\n                $code.toggleClass(classInvalidAnimation, false);\r\n                $code.dequeue();\r\n              });\r\n          return;\r\n        }\r\n\r\n        self.validate($code.val(), function(response) {\r\n          if (!response || !response.valid) {\r\n            $validate.toggleClass(classInvalid, true);\r\n            $validate.toggleClass(classValid, false);\r\n            $code.toggleClass(classInvalid, true);\r\n            $code.toggleClass(classValid, false);\r\n            $code.toggleClass(classInvalidAnimation, true)\r\n                .delay(1000)\r\n                .queue(function(){\r\n                  $code.toggleClass(classInvalidAnimation, false);\r\n                  $code.dequeue();\r\n                });\r\n            return;\r\n          }\r\n\r\n          $code.toggleClass(classInvalid, false);\r\n          $discountType.val(response.discount && response.discount.type || \"\");\r\n          $amountOff.val(response.discount && response.discount.amount_off || 0);\r\n          $unitOff.val(response.discount && response.discount.unit_off || 0);\r\n          $percentOff.val(response.discount && response.discount.percent_off || 0);\r\n          $tracking.val(response.tracking_id || \"\");\r\n\r\n          $code.prop(\"disabled\", true);\r\n          $validate.prop(\"disabled\", true);\r\n\r\n          $code.toggleClass(classValid, true);\r\n          $validate.toggleClass(classValid, true);\r\n          $validate.toggleClass(classInvalid, false);\r\n          $code.toggleClass(classInvalid, false);\r\n\r\n          $code.toggleClass(classValidAnimation, true)\r\n\r\n          if (options && options.onValidated && typeof options.onValidated === \"function\") {\r\n            options.onValidated(response);\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  if (typeof module !== \"undefined\" && module.exports) {\r\n    module.exports = voucherify;\r\n  }\r\n\r\n  return voucherify;\r\n} (window, window.document, window.jQuery));\r\n"],"sourceRoot":"/source/"}